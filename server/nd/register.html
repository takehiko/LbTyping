<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<title>問題登録</title>
<style>
  
  .form{
    margin:0 auto;
    width:80%;
    display:flex;
    flex-direction: column;
  }

  .form label{
    margin-bottom:3px;
  }

  .form input,.form textarea{
    width: 100%; /*親要素いっぱい広げる*/
    padding: 10px 15px; /*ボックスを大きくする*/
    font-size: 16px;
    border-radius: 3px; /*ボックス角の丸み*/
    border: 2px solid #ddd; /*枠線*/
    box-sizing: border-box; /*横幅の解釈をpadding, borderまでとする*/
  }


  .form .register{
    margin-top:30px;
    height:50px;
    width:300px;
    font-size:30px;
  }


  .button {
    display: inline-block;
    width: 200px;
    height: 54px;
    text-align: center;
    text-decoration: none;
    line-height: 54px;
    outline: none;
  }
  .button::before,
  .button::after {
    position: absolute;
    z-index: -1;
    display: block;
    content: '';
  }
  .button,
  .button::before,
  .button::after {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-transition: all .3s;
    transition: all .3s;
  }

  .button {
    background-color: #333;
    color: #fff;
  }

  .button:hover {
    background-color: #59b1eb;
  }

</style>
</head>
<body>
  <form action="" method="POST" class="form">
    <h1>登録画面</h1>
    <label for="qid">question ID</label>
    <input type="text" id="qid">
    <label for="qname">question name</label>
    <input type="text" id="qname">
    <label for=""></label>
    <label>動作確認</label>
    <iframe src="https://paiza.io/projects/e/tKXBoPbsg3J4fhq5uttehg?theme=twilight" width="100%" height="500" scrolling="no" seamless="seamless"></iframe>
    <label for="source">ソースコード</label>
    <textarea name="" id="source" cols="30" rows="10"></textarea>
    <label for="count">文字数</label>
    <input type="text" id="count">
    <label for="diff">難易度</label>
    <input type="text" id="diff">
    <label for="basename">basename</label>
    <input type="text" id="basename">
    <label for="comment">解説</label>
    <textarea name="" id="comment" cols="30" rows="10"></textarea>
    <label for="paiza">Paiza.ioのURL</label>
    <input type="text" id="paiza">
    <button class="register" type="button">登録</button>
  </form>
</body>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">
let qid;
let rid;
let res_data = null;
const flag_show_result = false;

// pathに基づきサーバに問い合わせる
const origin = location.origin;
const path_base = location.pathname.replace(/\/[^\/]*$/,"")
console.log(path_base);
const query = async (path) => {
  let res = await axios.get(origin + path_base + path);
  
  res_data = res.data;
  if (flag_show_result) {
    document.getElementById('result').innerHTML = JSON.stringify(res.data);
  }
}

const register = async() => {
  console.log("register function called");

  let qid = document.querySelector("#qid").value;
  let qname = document.querySelector("#qname").value;
  let source = document.querySelector("#source").value;
  let count = document.querySelector("#count").value;
  let basename = document.querySelector("#basename").value;
  let comment = document.querySelector("#comment").value;
  let paiza = document.querySelector("#paiza").value;

  console.log(source);

  

  comment = comment.replace('/\n/g','<br>');
  source = encodeURIComponent(source);

  
  
  // let qid = 507;
  // let qname = "test";
  // let source = "#include<stdio.h>\nint main(void){    int a = 5;\n}";
  // let count = 38;
  // let basename = "test2";
  // let comment="aaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
  // let paiza="http://google.com";
  
  //使い方を説明するpaizaIO
  //paizaIOのURLをどのように取得するか
  //more,解説文が書きやすいか？？
  //解説文のtextareaを移動可能に
  //registerだけでいい

  let queryString = `/register_question?qid=${qid}&qname=${qname}&source=${source}&count=${count}&basename=${basename}&comment=${comment}&paiza=${paiza}`;

  console.log(queryString);

  if(confirm("登録しますか?")){
    await query(queryString);
    alert("登録しました");
  }

}

document.querySelector("button.register").setAttribute("onclick","register()");

</script>
</html>