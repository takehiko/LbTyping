<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<title>問題登録</title>
<style>
  
  .form{
    margin:0 auto;
    border:1px solid black;
    width:80%;
    display:flex;
    flex-direction: column;
  }

  .form label{
    margin-bottom:3px;
  }

  .form input{
    width:30%;
  }

  .form textarea{
    width:30%;
  }

  .form .register{
    margin-top:30px;
    height:50px;
    width:300px;
    font-size:30px;
  }

</style>
</head>
<body>
  <h1>登録画面</h1>
  <form action="" method="POST" class="form">
    <label for="qid">question ID</label>
    <input type="text" id="qid">
    <label for="qname">question name</label>
    <input type="text" id="qname">
    <label for=""></label>
    <label>動作確認</label>
    <iframe src="https://paiza.io/projects/e/tKXBoPbsg3J4fhq5uttehg?theme=twilight" width="100%" height="500" scrolling="no" seamless="seamless"></iframe>
    <label for="source">ソースコード</label>
    <textarea name="" id="source" cols="30" rows="10"></textarea>
    <label for="count">文字数</label>
    <input type="text" id="count">
    <label for="diff">難易度</label>
    <input type="text" id="diff">
    <label for="basename">basename</label>
    <input type="text" id="basename">
    <label for="comment">解説</label>
    <textarea name="" id="comment" cols="30" rows="10"></textarea>
    <label for="paiza">Paiza.ioのURL</label>
    <input type="text" id="paiza">
  </form>
  <button class="register">登録</button>
  <div class="result"></div>
</body>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">
let qid;
let rid;
let res_data = null;
const flag_show_result = true;

// pathに基づきサーバに問い合わせる
const origin = location.origin;
const path_base = location.pathname.replace(/\/[^\/]*$/,"")
console.log(path_base);
const query = async (path) => {
  let res = await axios.get(origin + path_base + path);
  
  res_data = res.data;
  if (flag_show_result) {
    document.getElementById('result').innerHTML = JSON.stringify(res.data);
  }
}

const register = async() => {
  console.log("register_debug function called");

  let qid = document.querySelector("#qid").value;
  let qname = document.querySelector("#qname").value;
  let source = document.querySelector("#source").value;
  let count = document.querySelector("#count").value;
  let basename = document.querySelector("#basename").value;
  let comment = document.querySelector("#comment").value;
  let paiza = document.querySelector("#paiza").value;

  console.log(source);

  comment = comment.replace('/\n/g','<br>');
  source = encodeURIComponent(source);

  
  
  // let qid = 507;
  // let qname = "test";
  // let source = "#include<stdio.h>\nint main(void){    int a = 5;\n}";
  // let count = 38;
  // let basename = "test2";
  // let comment="aaaaaaaaaaaaaaaaaaaaaaaaaaaaa";
  // let paiza="http://google.com";  

  let queryString = `/register_question?qid=${qid}&qname=${qname}&source=${source}&count=${count}&basename=${basename}&comment=${comment}&paiza=${paiza}`;

  console.log(queryString);

  await query(queryString);

}

document.querySelector("button.register").setAttribute("onclick","register()");

</script>
</html>